{
  "description": "Sample E2SM-KPM Indication with Beam ID Support",
  "version": "1.0",
  "date": "2025-11-19",
  "author": "Agent 5",

  "sample_indication": {
    "timestamp": "2025-11-19T08:36:20.905608",
    "cell_id": "cell_001",
    "ue_id": "ue_005",
    "beam_id": 2,
    "measurements": [
      {
        "name": "DRB.PacketLossDl",
        "value": 2.5,
        "description": "Downlink packet loss rate"
      },
      {
        "name": "DRB.PacketLossUl",
        "value": 1.8,
        "description": "Uplink packet loss rate"
      },
      {
        "name": "DRB.UEThpDl",
        "value": 85.3,
        "description": "UE downlink throughput in Mbps"
      },
      {
        "name": "DRB.UEThpUl",
        "value": 42.1,
        "description": "UE uplink throughput in Mbps"
      },
      {
        "name": "RRU.PrbUsedDl",
        "value": 65.5,
        "description": "Downlink PRB usage percentage"
      },
      {
        "name": "RRU.PrbUsedUl",
        "value": 45.2,
        "description": "Uplink PRB usage percentage"
      },
      {
        "name": "UE.RSRP",
        "value": -95.2,
        "description": "Cell-level RSRP in dBm (legacy)"
      },
      {
        "name": "UE.RSRQ",
        "value": -10.5,
        "description": "Cell-level RSRQ in dB"
      },
      {
        "name": "UE.SINR",
        "value": 18.3,
        "description": "Cell-level SINR in dB"
      },
      {
        "name": "RRC.ConnEstabSucc",
        "value": 98.5,
        "description": "RRC connection establishment success rate"
      },
      {
        "name": "L1-RSRP.beam",
        "value": -82.5,
        "beam_id": 2,
        "description": "Beam-specific L1 RSRP in dBm (NEW)"
      },
      {
        "name": "L1-SINR.beam",
        "value": 21.8,
        "beam_id": 2,
        "description": "Beam-specific L1 SINR in dB (NEW)"
      }
    ],
    "indication_sn": 1763512450905,
    "indication_type": "report"
  },

  "multi_beam_scenario": {
    "description": "Multiple UEs on different beams in the same cell",
    "cell_id": "cell_001",
    "timestamp": "2025-11-19T08:36:20.905608",
    "ues": [
      {
        "ue_id": "ue_001",
        "beam_id": 0,
        "L1-RSRP": -78.2,
        "L1-SINR": 24.5,
        "quality": "Excellent"
      },
      {
        "ue_id": "ue_002",
        "beam_id": 1,
        "L1-RSRP": -83.1,
        "L1-SINR": 20.3,
        "quality": "Good"
      },
      {
        "ue_id": "ue_003",
        "beam_id": 2,
        "L1-RSRP": -88.5,
        "L1-SINR": 16.7,
        "quality": "Good"
      },
      {
        "ue_id": "ue_004",
        "beam_id": 3,
        "L1-RSRP": -92.3,
        "L1-SINR": 13.2,
        "quality": "Fair"
      },
      {
        "ue_id": "ue_005",
        "beam_id": 4,
        "L1-RSRP": -96.8,
        "L1-SINR": 10.5,
        "quality": "Fair"
      }
    ]
  },

  "redis_storage_examples": {
    "description": "How beam data is stored in Redis",
    "examples": [
      {
        "key": "kpi:cell_001:L1-RSRP.beam:beam_2",
        "value": {
          "timestamp": "2025-11-19T08:36:20.905608",
          "cell_id": "cell_001",
          "ue_id": "ue_005",
          "beam_id": 2,
          "kpi_name": "L1-RSRP.beam",
          "kpi_value": -82.5,
          "kpi_type": "beam_signal",
          "unit": "dBm",
          "beam_specific": true
        },
        "ttl": 300
      },
      {
        "key": "kpi:timeline:cell_001:beam_2",
        "type": "sorted_set",
        "description": "Timeline of measurements for beam 2",
        "sample_entries": [
          {"timestamp": "2025-11-19T08:36:15.000000", "value": -81.2},
          {"timestamp": "2025-11-19T08:36:20.000000", "value": -82.5},
          {"timestamp": "2025-11-19T08:36:25.000000", "value": -83.1}
        ]
      },
      {
        "key": "alarms:cell_001:beam_2",
        "type": "list",
        "description": "Beam-specific alarms",
        "sample_entry": {
          "timestamp": "2025-11-19T08:36:20.905608",
          "cell_id": "cell_001",
          "beam_id": 2,
          "anomalies": [
            {
              "kpi": "L1-SINR.beam",
              "value": 8.5,
              "threshold": 10.0,
              "type": "below_threshold",
              "beam_id": 2
            }
          ],
          "severity": "warning"
        }
      }
    ]
  },

  "influxdb_storage_examples": {
    "description": "How beam data is stored in InfluxDB",
    "measurement": "kpi_measurement",
    "examples": [
      {
        "tags": {
          "cell_id": "cell_001",
          "kpi_name": "L1-RSRP.beam",
          "kpi_type": "beam_signal",
          "beam_id": "2",
          "ue_id": "ue_005",
          "beam_specific": "true"
        },
        "fields": {
          "value": -82.5
        },
        "timestamp": "2025-11-19T08:36:20.905608Z"
      },
      {
        "tags": {
          "cell_id": "cell_001",
          "kpi_name": "L1-SINR.beam",
          "kpi_type": "beam_signal",
          "beam_id": "2",
          "ue_id": "ue_005",
          "beam_specific": "true"
        },
        "fields": {
          "value": 21.8
        },
        "timestamp": "2025-11-19T08:36:20.905608Z"
      }
    ],
    "query_examples": [
      {
        "description": "Get L1-RSRP for all beams in cell_001",
        "query": "from(bucket: \"kpimon\") |> range(start: -1h) |> filter(fn: (r) => r[\"cell_id\"] == \"cell_001\" and r[\"kpi_name\"] == \"L1-RSRP.beam\")"
      },
      {
        "description": "Get beam quality for specific beam",
        "query": "from(bucket: \"kpimon\") |> range(start: -1h) |> filter(fn: (r) => r[\"cell_id\"] == \"cell_001\" and r[\"beam_id\"] == \"2\" and r[\"beam_specific\"] == \"true\")"
      },
      {
        "description": "Compare all beams in a cell",
        "query": "from(bucket: \"kpimon\") |> range(start: -1h) |> filter(fn: (r) => r[\"cell_id\"] == \"cell_001\" and r[\"kpi_name\"] == \"L1-RSRP.beam\") |> group(columns: [\"beam_id\"]) |> mean()"
      }
    ]
  },

  "prometheus_metrics_examples": {
    "description": "Prometheus metrics with beam_id labels",
    "examples": [
      {
        "metric": "kpimon_kpi_value",
        "labels": {
          "kpi_type": "L1-RSRP.beam",
          "cell_id": "cell_001",
          "beam_id": "2"
        },
        "value": -82.5,
        "description": "Current L1-RSRP for beam 2 in cell_001"
      },
      {
        "metric": "kpimon_kpi_value",
        "labels": {
          "kpi_type": "L1-SINR.beam",
          "cell_id": "cell_001",
          "beam_id": "2"
        },
        "value": 21.8,
        "description": "Current L1-SINR for beam 2 in cell_001"
      }
    ],
    "query_examples": [
      {
        "description": "Get L1-RSRP for specific beam",
        "query": "kpimon_kpi_value{kpi_type=\"L1-RSRP.beam\", cell_id=\"cell_001\", beam_id=\"2\"}"
      },
      {
        "description": "Get L1-RSRP for all beams",
        "query": "kpimon_kpi_value{kpi_type=\"L1-RSRP.beam\", cell_id=\"cell_001\"}"
      },
      {
        "description": "Average beam quality across all beams",
        "query": "avg by (beam_id) (kpimon_kpi_value{kpi_type=\"L1-SINR.beam\", cell_id=\"cell_001\"})"
      },
      {
        "description": "Find best beam (highest SINR)",
        "query": "topk(1, kpimon_kpi_value{kpi_type=\"L1-SINR.beam\", cell_id=\"cell_001\"})"
      }
    ]
  },

  "beam_handover_scenario": {
    "description": "UE switching from beam 2 to beam 3",
    "ue_id": "ue_005",
    "cell_id": "cell_001",
    "timeline": [
      {
        "timestamp": "2025-11-19T08:36:15.000000",
        "beam_id": 2,
        "L1-RSRP": -82.5,
        "L1-SINR": 21.8,
        "event": "Serving on beam 2"
      },
      {
        "timestamp": "2025-11-19T08:36:20.000000",
        "beam_id": 2,
        "L1-RSRP": -88.3,
        "L1-SINR": 15.2,
        "event": "Signal degrading on beam 2"
      },
      {
        "timestamp": "2025-11-19T08:36:22.000000",
        "beam_id": 2,
        "L1-RSRP": -92.1,
        "L1-SINR": 11.5,
        "event": "Trigger beam measurement"
      },
      {
        "timestamp": "2025-11-19T08:36:23.000000",
        "beam_id": 3,
        "L1-RSRP": -78.5,
        "L1-SINR": 23.2,
        "event": "Beam 3 has better quality"
      },
      {
        "timestamp": "2025-11-19T08:36:25.000000",
        "beam_id": 3,
        "L1-RSRP": -79.1,
        "L1-SINR": 22.8,
        "event": "Switched to beam 3"
      }
    ]
  },

  "use_case_examples": {
    "beam_selection": {
      "description": "Select best beam for UE based on RSRP and SINR",
      "cell_id": "cell_001",
      "ue_position": "sector_edge",
      "candidate_beams": [
        {"beam_id": 2, "L1-RSRP": -88.5, "L1-SINR": 14.2, "score": 0.65},
        {"beam_id": 3, "L1-RSRP": -82.1, "L1-SINR": 19.8, "score": 0.85},
        {"beam_id": 4, "L1-RSRP": -95.2, "L1-SINR": 10.5, "score": 0.45}
      ],
      "selected_beam": 3,
      "reason": "Best combination of RSRP and SINR"
    },

    "load_balancing": {
      "description": "Balance load across beams",
      "cell_id": "cell_001",
      "timestamp": "2025-11-19T08:36:25.000000",
      "beam_load": [
        {"beam_id": 0, "ue_count": 8, "avg_throughput": 45.2, "prb_usage": 85.5, "status": "overloaded"},
        {"beam_id": 1, "ue_count": 5, "avg_throughput": 62.1, "prb_usage": 55.3, "status": "normal"},
        {"beam_id": 2, "ue_count": 3, "avg_throughput": 78.5, "prb_usage": 35.2, "status": "underutilized"},
        {"beam_id": 3, "ue_count": 4, "avg_throughput": 68.3, "prb_usage": 42.1, "status": "normal"}
      ],
      "action": "Move UEs from beam 0 to beam 2",
      "expected_improvement": "15% better average throughput"
    },

    "interference_detection": {
      "description": "Detect beam-specific interference",
      "cell_id": "cell_001",
      "beam_id": 5,
      "timestamp": "2025-11-19T08:36:25.000000",
      "measurements": {
        "L1-RSRP": -82.5,
        "L1-SINR": 6.2,
        "expected_SINR": 18.0,
        "degradation": 11.8
      },
      "diagnosis": "Beam 5 experiencing interference",
      "possible_causes": [
        "Co-channel interference from neighbor cell",
        "Beam misalignment",
        "External interference source"
      ],
      "recommended_action": "Adjust beam power or switch affected UEs to different beam"
    }
  },

  "backward_compatibility": {
    "description": "Demonstration of backward compatibility",
    "old_format": {
      "timestamp": "2025-11-19T08:36:20.905608",
      "cell_id": "cell_001",
      "ue_id": "ue_005",
      "measurements": [
        {"name": "UE.RSRP", "value": -95.2},
        {"name": "UE.RSRQ", "value": -10.5},
        {"name": "UE.SINR", "value": 18.3}
      ]
    },
    "new_format": {
      "timestamp": "2025-11-19T08:36:20.905608",
      "cell_id": "cell_001",
      "ue_id": "ue_005",
      "beam_id": 2,
      "measurements": [
        {"name": "UE.RSRP", "value": -95.2},
        {"name": "UE.RSRQ", "value": -10.5},
        {"name": "UE.SINR", "value": 18.3},
        {"name": "L1-RSRP.beam", "value": -82.5, "beam_id": 2},
        {"name": "L1-SINR.beam", "value": 21.8, "beam_id": 2}
      ]
    },
    "compatibility_notes": [
      "beam_id is optional - old code can ignore it",
      "Legacy KPIs (UE.RSRP, UE.RSRQ, UE.SINR) still present",
      "New beam-specific KPIs have beam_id in measurement",
      "Systems without beam support continue to work normally"
    ]
  }
}
