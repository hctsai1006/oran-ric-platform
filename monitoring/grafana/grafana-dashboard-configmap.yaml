---
# Grafana Dashboard ConfigMap for Kubernetes
# This ConfigMap contains the dual-path communication dashboard
# and can be mounted into Grafana pod for automatic provisioning
#
# Usage:
#   kubectl apply -f monitoring/grafana/grafana-dashboard-configmap.yaml
#
# Then update Grafana deployment to mount this ConfigMap:
#   volumeMounts:
#     - name: dual-path-dashboard
#       mountPath: /var/lib/grafana/dashboards/oran-ric
#   volumes:
#     - name: dual-path-dashboard
#       configMap:
#         name: grafana-dual-path-dashboard

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dual-path-dashboard
  namespace: ricplt
  labels:
    app: grafana
    component: dashboard
    grafana_dashboard: "1"
data:
  dual-path-communication.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "datasource",
              "uid": "grafana"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "description": "O-RAN SC Release J - Dual-Path Communication Monitoring Dashboard (RMR + HTTP Redundancy)",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 1,
      "id": null,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          },
          "description": "Current active communication path across all xApps",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "blue",
                      "index": 0,
                      "text": "RMR"
                    },
                    "1": {
                      "color": "orange",
                      "index": 1,
                      "text": "HTTP"
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": null
                  },
                  {
                    "color": "orange",
                    "value": 1
                  }
                ]
              },
              "unit": "short"
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 0
          },
          "id": 1,
          "targets": [
            {
              "expr": "dual_path_active_path",
              "legendFormat": "{{app}} - {{xapp_name}}"
            }
          ],
          "title": "Active Communication Path",
          "type": "gauge"
        }
      ],
      "refresh": "10s",
      "schemaVersion": 38,
      "style": "dark",
      "tags": [
        "o-ran",
        "ric",
        "xapp",
        "dual-path"
      ],
      "title": "O-RAN RIC - Dual-Path Communication",
      "uid": "oran-dual-path",
      "version": 1
    }
